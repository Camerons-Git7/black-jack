<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blackjack</title>
    <link rel="icon" type="image/x-icon" href="https://math.hws.edu/favicon.ico">
    <script src="https://unpkg.com/peerjs@1.4.7/dist/peerjs.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700;900&family=Playfair+Display:ital,wght@0,400;0,700;1,400&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            overflow: hidden;
            background: #0f2015;
            font-family: 'Cinzel', serif;
        }

        /* INTRO STYLES */
        .intro-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: radial-gradient(ellipse at center, #1b5e20 0%, #0d3318 50%, #051a0a 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            transition: opacity 1s ease-out, transform 1s ease-out;
        }

        .intro-container.exit {
            opacity: 0;
            transform: scale(1.1);
            pointer-events: none;
        }

        .felt-texture {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                repeating-linear-gradient(45deg, transparent, transparent 35px, rgba(0,0,0,.03) 35px, rgba(0,0,0,.03) 70px),
                repeating-linear-gradient(-45deg, transparent, transparent 35px, rgba(255,255,255,.02) 35px, rgba(255,255,255,.02) 70px);
            pointer-events: none;
        }

        .floating-cards {
            position: absolute;
            width: 100%;
            height: 100%;
            overflow: hidden;
            pointer-events: none;
        }

        .floating-card {
            position: absolute;
            width: 79px;
            height: 123px;
            background-image: url('https://math.hws.edu/eck/cs271/js-work/cards.png');
            background-size: 1027px 615px;
            background-position: -158px -492px;
            background-repeat: no-repeat;
            background-color: transparent;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            animation: floatUp 18s infinite linear;
            opacity: 0;
            bottom: -150px;
        }

        .floating-card:nth-child(1) { left: 15%; animation-delay: 0s; animation-duration: 16s; }
        .floating-card:nth-child(2) { left: 85%; animation-delay: 6s; animation-duration: 20s; }
        .floating-card:nth-child(3) { left: 50%; animation-delay: 12s; animation-duration: 18s; }

        @keyframes floatUp {
            0% { transform: translateY(0) rotate(0deg); opacity: 0; }
            5% { opacity: 0.6; }
            95% { opacity: 0.6; }
            100% { transform: translateY(-120vh) rotate(360deg); opacity: 0; }
        }

        .title-container {
            text-align: center;
            z-index: 10;
            animation: titleEntry 1.5s ease-out;
        }

        @keyframes titleEntry {
            0% { transform: translateY(-50px); opacity: 0; }
            100% { transform: translateY(0); opacity: 1; }
        }

        .main-title {
            font-size: 6rem;
            font-weight: 900;
            color: #ffd700;
            text-shadow: 
                0 0 20px rgba(255, 215, 0, 0.5),
                0 4px 8px rgba(0,0,0,0.8),
                -2px -2px 0 #b8860b,
                2px -2px 0 #b8860b,
                -2px 2px 0 #b8860b,
                2px 2px 0 #b8860b;
            letter-spacing: 0.1em;
            margin-bottom: 1rem;
            position: relative;
            display: inline-block;
        }

        .main-title::after {
            content: '♠';
            position: absolute;
            right: -60px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 3rem;
            color: #000;
            text-shadow: 0 0 10px rgba(255,255,255,0.3);
            animation: pulse 2s infinite;
        }

        .main-title::before {
            content: '♥';
            position: absolute;
            left: -60px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 3rem;
            color: #d40000;
            text-shadow: 0 0 10px rgba(255,0,0,0.3);
            animation: pulse 2s infinite 0.5s;
        }

        @keyframes pulse {
            0%, 100% { transform: translateY(-50%) scale(1); }
            50% { transform: translateY(-50%) scale(1.2); }
        }

        .subtitle {
            font-family: 'Playfair Display', serif;
            font-size: 1.5rem;
            color: #fff;
            letter-spacing: 0.3em;
            text-transform: uppercase;
            margin-bottom: 3rem;
            text-shadow: 0 2px 4px rgba(0,0,0,0.8);
            animation: fadeIn 2s ease-out 0.5s both;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .divider {
            width: 300px;
            height: 2px;
            margin: 2rem auto;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .divider-line {
            position: absolute;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, #ffd700, transparent);
            transform-origin: center;
            transform: scaleX(0);
            animation: expandLine 1.2s ease-out 0.8s forwards;
        }

        .divider-text {
            position: relative;
            background: #1b5e20;
            padding: 0 20px;
            color: #ffd700;
            font-size: 1.2rem;
            letter-spacing: 10px;
            z-index: 2;
            opacity: 0;
            animation: popIn 0.5s ease-out 1.5s forwards;
        }

        @keyframes expandLine {
            from { transform: scaleX(0); opacity: 0; }
            to { transform: scaleX(1); opacity: 1; }
        }

        @keyframes popIn {
            from { opacity: 0; transform: translateY(-10px) scale(0.8); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }

        .button-container {
            display: flex;
            gap: 25px;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
            margin-top: 2rem;
            animation: fadeIn 2s ease-out 1s both;
        }

        .start-btn {
            padding: 20px 60px;
            font-family: 'Cinzel', serif;
            font-size: 1.5rem;
            font-weight: 700;
            color: #1a1a1a;
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 50%, #ffd700 100%);
            border: 3px solid #b8860b;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 
                0 6px 20px rgba(0,0,0,0.4),
                0 0 30px rgba(255, 215, 0, 0.3),
                inset 0 2px 5px rgba(255,255,255,0.3);
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.2em;
            position: relative;
            overflow: hidden;
        }

        .start-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            transition: left 0.5s;
        }

        .start-btn:hover::before {
            left: 100%;
        }

        .start-btn:hover {
            transform: translateY(-3px);
            box-shadow: 
                0 10px 30px rgba(0,0,0,0.5),
                0 0 50px rgba(255, 215, 0, 0.5),
                inset 0 2px 5px rgba(255,255,255,0.4);
            background: linear-gradient(135deg, #ffed4e 0%, #ffd700 50%, #ffed4e 100%);
        }

        .start-btn:active {
            transform: translateY(-1px);
        }

        .multiplayer-btn {
            background: linear-gradient(135deg, #4a5568 0%, #2d3748 50%, #4a5568 100%);
            border-color: #1a202c;
            color: #ffffff;
            box-shadow: 
                0 6px 20px rgba(0,0,0,0.4),
                0 0 30px rgba(74, 85, 104, 0.3),
                inset 0 2px 5px rgba(255,255,255,0.2);
        }

        .multiplayer-btn:hover {
            background: linear-gradient(135deg, #718096 0%, #4a5568 50%, #718096 100%);
            box-shadow: 
                0 10px 30px rgba(0,0,0,0.5),
                0 0 50px rgba(113, 128, 150, 0.5),
                inset 0 2px 5px rgba(255,255,255,0.3);
            color: #000000;
        }

        .chips-stack {
            position: absolute;
            bottom: 50px;
            right: 100px;
            animation: fadeIn 2s ease-out 1.2s both;
        }

        .chip {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            position: absolute;
            border: 4px dashed #fff;
            box-shadow: 0 4px 10px rgba(0,0,0,0.4);
        }

        .chip:nth-child(1) { background: #d40000; bottom: 0; right: 0; }
        .chip:nth-child(2) { background: #0000d4; bottom: 10px; right: 5px; transform: rotate(30deg); }
        .chip:nth-child(3) { background: #00d400; bottom: 20px; right: -5px; transform: rotate(60deg); }
        .chip:nth-child(4) { background: #ffd700; bottom: 30px; right: 5px; transform: rotate(90deg); }

        .chips-stack::after {
            content: '$';
            position: absolute;
            bottom: 35px;
            right: 28px;
            font-size: 2rem;
            font-weight: bold;
            color: rgba(255,255,255,0.8);
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }

        .cards-spread {
            position: absolute;
            bottom: 50px;
            left: 100px;
            width: 200px;
            height: 140px;
            animation: fadeIn 2s ease-out 1.4s both;
        }

        .spread-card {
            position: absolute;
            width: 79px;
            height: 123px;
            background-image: url('https://math.hws.edu/eck/cs271/js-work/cards.png');
            background-size: 1027px 615px;
            background-repeat: no-repeat;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            transform-origin: bottom center;
        }

        .spread-card:nth-child(1) { transform: rotate(-20deg) translateX(-20px); background-position: -711px -369px; }
        .spread-card:nth-child(2) { transform: rotate(-10deg) translateX(-10px); left: 30px; background-position: -790px -369px; }
        .spread-card:nth-child(3) { transform: rotate(0deg); left: 60px; background-position: -869px -369px; }
        .spread-card:nth-child(4) { transform: rotate(10deg) translateX(10px); left: 90px; background-position: -948px -369px; }
        .spread-card:nth-child(5) { transform: rotate(20deg) translateX(20px); left: 120px; background-position: 0px -369px; }

        @media (max-width: 768px) {
            .main-title { font-size: 3.5rem; }
            .main-title::before, .main-title::after { display: none; }
            .subtitle { font-size: 1rem; letter-spacing: 0.2em; }
            .button-container { flex-direction: column; gap: 15px; }
            .start-btn { padding: 15px 40px; font-size: 1.2rem; }
            .chips-stack, .cards-spread { display: none; }
        }

        .sparkle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: #ffd700;
            border-radius: 50%;
            animation: sparkle 3s infinite;
        }

        @keyframes sparkle {
            0%, 100% { opacity: 0; transform: scale(0); }
            50% { opacity: 1; transform: scale(1); }
        }

        /* SINGLE PLAYER GAME STYLES (ORIGINAL) */
        #game-container {
            display: none;
            width: 100vw;
            height: 100vh;
            font-family: "Times New Roman", Times, serif;
        }

        #table {
            width: 100vw;
            height: 100vh;
            background-color: #008000;
            border: none;
            margin: 0;
            position: relative;
            color: #66FF66;
            font-size: 16pt;
            font-weight: bold;
            box-sizing: border-box;
            border: 8px ridge #663300;
        }

        .cardPlace {
            background-color: #666600;
            width: 79px;
            height: 123px;
            position: absolute;
            border: 1px solid #444400;
            box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.5);
        }

        #dealerLabel {
            position: absolute;
            top: 5%;
            left: 5%;
            color: #66FF66;
            text-shadow: 2px 2px 4px #000;
        }

        #playerLabel {
            position: absolute;
            top: 35%;
            left: 5%;
            color: #66FF66;
            text-shadow: 2px 2px 4px #000;
        }

        #playerValue {
            position: absolute;
            top: 64%;
            left: 50%;
            transform: translateX(-50%);
            font-size: 28pt;
            font-weight: bold;
            text-shadow: 3px 3px 6px #000;
            white-space: nowrap;
            z-index: 20;
        }

        #dealerValue {
            position: absolute;
            top: 3%;
            left: 50%;
            transform: translateX(-50%);
            font-size: 14pt;
            font-weight: bold;
            text-shadow: 3px 3px 6px #000;
            white-space: nowrap;
            z-index: 20;
        }

        #moneyLabel {
            position: absolute;
            bottom: 12%;
            left: 5%;
            color: #FFFF00;
            font-size: 20pt;
            text-shadow: 2px 2px 4px #000;
        }

        #betLabel {
            position: absolute;
            bottom: 12%;
            right: 5%;
            color: #66FF66;
            font-size: 16pt;
        }

        #bet {
            width: 80px;
            background-color: white;
            border: 2px inset #666666;
            font-size: 14pt;
            padding: 2px;
        }

        #buttonContainer {
            position: absolute;
            bottom: 5%;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
            background: rgba(0, 0, 0, 0.3);
            padding: 10px 20px;
            border-radius: 10px;
        }

        button {
            font-size: 14pt;
            margin: 0 8px;
            padding: 8px 20px;
            border-radius: 5px;
            border: 2px solid #444;
            background: linear-gradient(to bottom, #f0f0f0, #c0c0c0);
            cursor: pointer;
            font-weight: bold;
            box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        button:hover:not(:disabled) {
            background: linear-gradient(to bottom, #ffffff, #d0d0d0);
            transform: translateY(-2px);
            box-shadow: 3px 3px 6px rgba(0, 0, 0, 0.5);
        }

        button:disabled {
            color: #666666;
            background: #cccccc;
            cursor: not-allowed;
            box-shadow: none;
        }

        #message {
            position: absolute;
            bottom: 18%;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
            color: #FFFFFF;
            font-weight: bold;
            font-size: 18pt;
            text-shadow: 2px 2px 4px #000;
            width: 80%;
            min-height: 30px;
        }

        #bettingControls {
            position: absolute;
            bottom: 25%;
            left: 87.25%;
            transform: translateX(-50%);
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            z-index: 30;
            background: rgba(0, 0, 0, 0.5);
            padding: 12px 20px;
            border-radius: 20px;
            max-width: 50%;
        }

        .bet-btn {
            background-color: #FFFF00 !important;
            color: #000000 !important;
            border: 2px solid #CC9900 !important;
            border-radius: 16px !important;
            padding: 10px 18px !important;
            font-size: 13pt !important;
            font-weight: bold !important;
            cursor: pointer;
            box-shadow: 3px 3px 6px rgba(0, 0, 0, 0.6) !important;
            min-width: 60px;
            transition: all 0.2s ease;
            margin: 0 2px !important;
        }

        .bet-btn:hover {
            background-color: #FFD700 !important;
            transform: translateY(-2px) scale(1.05);
            box-shadow: 4px 4px 8px rgba(0, 0, 0, 0.7) !important;
        }

        #resetMoneyButton {
            position: absolute;
            top: 60%;
            left: 12%;
            transform: translateX(-50%);
            margin: 0;
        }

        /* MULTIPLAYER LOBBY */
        .lobby-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(5, 26, 10, 0.95);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            color: #ffd700;
        }

        .lobby-box {
            background: linear-gradient(135deg, #1b5e20 0%, #0d3318 100%);
            border: 3px solid #ffd700;
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            max-width: 90%;
            width: 500px;
        }

        .room-code-display {
            font-size: 3rem;
            letter-spacing: 10px;
            background: rgba(0, 0, 0, 0.5);
            padding: 20px;
            margin: 20px 0;
            font-family: monospace;
            border: 2px solid #ffd700;
            color: #00ff00;
        }

        .code-input {
            font-size: 2rem;
            letter-spacing: 5px;
            text-align: center;
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid #ffd700;
            color: #ffd700;
            padding: 15px;
            width: 100%;
            margin: 20px 0;
            font-family: monospace;
            text-transform: uppercase;
        }

        .lobby-btn {
            padding: 15px 40px;
            font-family: 'Cinzel', serif;
            font-size: 1.2rem;
            font-weight: 700;
            color: #1a1a1a;
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
            border: 3px solid #b8860b;
            border-radius: 50px;
            cursor: pointer;
            margin: 10px;
            transition: all 0.3s ease;
        }

        /* MULTIPLAYER GAME - FIXED */
        #multiplayer-container {
            display: none;
            width: 100vw;
            height: 100vh;
            font-family: "Times New Roman", Times, serif;
        }

        #mp-table {
            width: 100vw;
            height: 100vh;
            background-color: #008000;
            position: relative;
            color: #66FF66;
            font-size: 16pt;
            font-weight: bold;
            border: 8px ridge #663300;
            box-sizing: border-box;
        }

        .mp-cardPlace {
            background-color: #666600;
            width: 79px;
            height: 123px;
            position: absolute;
            border: 1px solid #444400;
            box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.5);
        }

        #mp-opponentLabel {
            position: absolute;
            top: 5%;
            left: 5%;
            color: #FF6B6B;
            text-shadow: 2px 2px 4px #000;
            font-size: 16pt;
        }

        #mp-playerLabel {
            position: absolute;
            top: 35%;
            left: 5%;
            color: #4ECDC4;
            text-shadow: 2px 2px 4px #000;
            font-size: 16pt;
        }

        #mp-playerValue {
            position: absolute;
            top: 64%;
            left: 50%;
            transform: translateX(-50%);
            font-size: 28pt;
            font-weight: bold;
            text-shadow: 3px 3px 6px #000;
            color: #FFD700;
            white-space: nowrap;
            z-index: 20;
        }

        #mp-opponentValue {
            position: absolute;
            top: 3%;
            left: 50%;
            transform: translateX(-50%);
            font-size: 14pt;
            font-weight: bold;
            text-shadow: 3px 3px 6px #000;
            color: #FF6B6B;
            white-space: nowrap;
            z-index: 20;
        }

        #mp-moneyLabel {
            position: absolute;
            bottom: 12%;
            left: 5%;
            color: #FFFF00;
            font-size: 20pt;
            text-shadow: 2px 2px 4px #000;
        }

        #mp-opponentMoneyLabel {
            position: absolute;
            top: 8%;
            right: 5%;
            color: #FF6B6B;
            font-size: 18pt;
            text-shadow: 2px 2px 4px #000;
        }

        #mp-betLabel {
            position: absolute;
            bottom: 12%;
            right: 5%;
            color: #66FF66;
            font-size: 16pt;
        }

        #mp-bet {
            width: 80px;
            background-color: white;
            border: 2px inset #666666;
            font-size: 14pt;
            padding: 2px;
        }

        #mp-buttonContainer {
            position: absolute;
            bottom: 5%;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
            background: rgba(0, 0, 0, 0.3);
            padding: 10px 20px;
            border-radius: 10px;
        }

        #mp-buttonContainer button {
            font-size: 14pt;
            margin: 0 8px;
            padding: 8px 20px;
            border-radius: 5px;
            border: 2px solid #444;
            background: linear-gradient(to bottom, #f0f0f0, #c0c0c0);
            cursor: pointer;
            font-weight: bold;
            box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        #mp-buttonContainer button:hover:not(:disabled) {
            background: linear-gradient(to bottom, #ffffff, #d0d0d0);
            transform: translateY(-2px);
            box-shadow: 3px 3px 6px rgba(0, 0, 0, 0.5);
        }

        #mp-buttonContainer button:disabled {
            color: #666666;
            background: #cccccc;
            cursor: not-allowed;
            box-shadow: none;
        }

        #mp-message {
            position: absolute;
            bottom: 18%;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
            color: #FFFFFF;
            font-weight: bold;
            font-size: 18pt;
            text-shadow: 2px 2px 4px #000;
            width: 80%;
            min-height: 30px;
        }

        #turnIndicator {
            position: absolute;
            top: 48%;
            left: 50%;
            transform: translateX(-50%);
            font-size: 24pt;
            color: #FFD700;
            text-shadow: 3px 3px 6px #000;
            background: rgba(0,0,0,0.8);
            padding: 20px 40px;
            border-radius: 15px;
            border: 3px solid #FFD700;
            display: none;
            z-index: 50;
            animation: fadeIn 0.3s;
        }

        #turnIndicator.fade-out {
            animation: fadeOut 0.5s forwards;
        }

        @keyframes fadeOut { to { opacity: 0; } }

        .online-indicator {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(0, 255, 0, 0.2);
            border: 2px solid #00ff00;
            color: #00ff00;
            padding: 10px;
            border-radius: 10px;
            font-size: 12pt;
            z-index: 100;
        }
    </style>
</head>
<body>

    <!-- INTRO SCREEN -->
    <div class="intro-container" id="intro">
        <div class="felt-texture"></div>
        
        <div class="floating-cards">
            <div class="floating-card"></div>
            <div class="floating-card"></div>
            <div class="floating-card"></div>
        </div>

        <div class="sparkle" style="top: 20%; left: 20%; animation-delay: 0s;"></div>
        <div class="sparkle" style="top: 30%; left: 80%; animation-delay: 1s;"></div>
        <div class="sparkle" style="top: 70%; left: 15%; animation-delay: 2s;"></div>
        <div class="sparkle" style="top: 80%; left: 85%; animation-delay: 1.5s;"></div>

        <div class="title-container">
            <h1 class="main-title">BLACKJACK</h1>
            
            <div class="divider">
                <div class="divider-line"></div>
                <span class="divider-text">♣ ♦</span>
            </div>
            
            <p class="subtitle">Fun Edition</p>
            
            <div class="button-container">
                <button class="start-btn" onclick="startSinglePlayer()">Single Player</button>
                <button class="start-btn multiplayer-btn" onclick="showLobby()">Multiplayer</button>
            </div>
        </div>

        <div class="cards-spread">
            <div class="spread-card"></div>
            <div class="spread-card"></div>
            <div class="spread-card"></div>
            <div class="spread-card"></div>
            <div class="spread-card"></div>
        </div>

        <div class="chips-stack">
            <div class="chip"></div>
            <div class="chip"></div>
            <div class="chip"></div>
            <div class="chip"></div>
        </div>
    </div>

    <!-- MULTIPLAYER LOBBY -->
    <div class="lobby-overlay" id="lobby">
        <div class="lobby-box" id="lobbyMenu">
            <h2 style="margin-bottom: 30px;">Multiplayer Lobby</h2>
            <button class="lobby-btn" onclick="createRoom()">Create Room</button>
            <button class="lobby-btn" onclick="showJoin()">Join Room</button>
            <button class="lobby-btn" onclick="hideLobby()" style="background: #666;">Back</button>
        </div>
        
        <div class="lobby-box" id="createMenu" style="display: none;">
            <h3>Your Room Code</h3>
            <div class="room-code-display" id="roomCode">------</div>
            <p>Share this code with opponent</p>
            <div id="hostStatus" style="margin: 20px 0; color: #aaa;">Creating...</div>
            <button class="lobby-btn" onclick="cancelHost()">Cancel</button>
        </div>

        <div class="lobby-box" id="joinMenu" style="display: none;">
            <h3>Enter Room Code</h3>
            <input type="text" class="code-input" id="codeInput" maxlength="6" placeholder="ABCDEF">
            <div id="joinStatus" style="color: #ff6666; min-height: 24px;"></div>
            <button class="lobby-btn" onclick="joinRoom()">Connect</button>
            <button class="lobby-btn" onclick="backToLobby()" style="background: #666;">Back</button>
        </div>
    </div>

    <!-- SINGLE PLAYER GAME (ORIGINAL) -->
    <div id="game-container">
        <div id="table">
            <div id="dealerLabel">Dealer's cards:</div>
            <div id="playerLabel">Your cards:</div>
            <div id="dealerValue">Dealer's Hand: <span id="dealerValueDisplay">--</span></div>
            <div id="playerValue">Your Hand: <span id="playerValueDisplay">00</span></div>
            <div id="moneyLabel">You have: <span id="money">$100</span></div>
            <div id<parameter name="instructions">The user is reporting three specific issues with the multiplayer Blackjack code:

1. "if I stand it automatically makes my opponent win" - This suggests that when a player clicks "Stand", the game immediately resolves with the opponent winning, rather than waiting for the opponent to take their turn.

2. "he can't see my card right after i click hit" - The opponent isn't seeing the card appear when the player hits.

3. "my opponent can't do anything" - The opponent's buttons aren't enabling when it's their turn.

Looking at the previous code provided, I need to identify these specific bugs:

1. **Stand logic bug**: When the host stands, it should pass the turn to the client, not immediately end the game. The game should only end when BOTH players have either stood or busted.

2. **Card visibility bug**: When a player hits, the card index being sent to the opponent might be wrong, or the opponent isn't rendering it correctly.

3. **Turn enablement bug**: When the host stands, the client isn't receiving the signal to enable their buttons.

Let me analyze the specific code sections:

In `endMPTurn`:
```javascript
function endMPTurn(busted) {
    mpMyTurn = false;
    document.getElementById('mp-hitButton').disabled = true;
    document.getElementById('mp-standButton').disabled = true;
    
    const val = getHandValue(mpMyCards);
    
    send({
        type: 'stand',
        busted: busted,
        value: val
    });
    
    if (busted) {
        if (isHost) {
            // I busted, opponent wins
            mpMyMoney -= mpCurrentBet;
            mpOppMoney += mpCurrentBet;
            document.getElementById('mp-message').textContent = 'You busted! Opponent wins.';
            revealMPOpponentCards();
            endMPGame(2);
        } else {
            // I busted (client), host will handle
            document.getElementById('mp-message').textContent = 'You busted! Waiting...';
        }
    } else {
        if (isHost) {
            // I stood, now opponent's turn
            document.getElementById('mp-message').textContent = 'Waiting for opponent...';
            // Opponent will play now
        } else {
            // I stood (client), compare
            document.getElementById('mp-message').textContent = 'Comparing hands...';
            // Both have stood, resolve
            setTimeout(() => resolveMPGame(), 1000);
        }
    }
}
